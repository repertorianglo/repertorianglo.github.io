---

import { SITE_TITLE } from '../consts';
import HeaderLinkDiv from './HeaderLinkDiv.astro';
import ColorCycleText from './ColorCycleText.astro';
import { getEixosTematicos } from '../common/eixosTematicos';

const eixosTematicos = await getEixosTematicos();

const { hasSubheader } = Astro.props;

let isMenuOpen = false;
let isEixosOpen = false;

function toggleMenu() {
	isMenuOpen = !isMenuOpen;
	if (!isMenuOpen) isEixosOpen = false;
}
function toggleEixos() {
	isEixosOpen = !isEixosOpen;
}
---


<header>
	<nav class="relative flex items-center justify-center lg:justify-between h-[50px]">
		<!-- Hamburger button (mobile only) -->
		<button id="hamburger-btn" class="absolute left-0 lg:hidden mr-2 flex items-center justify-center" aria-label="Abrir menu" style="background:none;border:none;padding:0;outline:none;">
			<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
		<h2 class="h-full flex items-center font-bold"><a class="z-10" href="/"><ColorCycleText text={SITE_TITLE} /></a></h2>
		<div class="absolute w-full justify-center gap-2 h-full hidden lg:flex">
			<HeaderLinkDiv href="/">Home</HeaderLinkDiv>
			<HeaderLinkDiv href="/about">Sobre Nós</HeaderLinkDiv>
		</div>
		<div class="h-100 social-links">
			<!-- ...existing code... -->
		</div>
		<!-- Mobile menu overlay -->
			<div id="mobile-menu-overlay" class="fixed inset-0 z-50 bg-black/40 flex min-h-full" style="display:none;">
				<div class="bg-white w-64 shadow-lg p-5 flex flex-col gap-4 animate-slidein relative items-start justify-start">
				<button id="close-menu-btn" aria-label="Fechar menu" class="absolute top-3 -right-4 rounded-full c-bg-primary p-1" style="background:none;border:none;outline:none;">
					<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
				</button>
				<a href="/" class="py-2 px-2 rounded hover:bg-gray-100 font-medium menu-link">Home</a>
				<a href="/about" class="py-2 px-2 rounded hover:bg-gray-100 font-medium menu-link">Sobre Nós</a>
				<div class="w-full">
					<button id="eixos-toggle-btn" class="w-full text-left py-2 px-2 rounded hover:bg-gray-100 font-medium flex items-center justify-between" aria-expanded="false" aria-controls="submenu-eixos">
						Eixos Temáticos
						<svg id="eixos-arrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transition: transform 0.2s;"><polyline points="9 18 15 12 9 6"/></svg>
					</button>
					<ul id="submenu-eixos" class="pl-4 mt-2 flex flex-col gap-2" style="display:none;">
						{eixosTematicos.map((eixo) => (
							<li>
								<a href={eixo.href} class="block py-1 px-2 rounded hover:bg-gray-100 text-sm submenu-link">{eixo.title}</a>
							</li>
						))}
					</ul>
				</div>
			</div>
			<div id="menu-bg-close" style="flex:1;"></div>
		</div>
	</nav>
</header>

<script>
	let menuOpen = false;
	let eixosOpen = false;
	const menu = document.getElementById('mobile-menu-overlay');
	const hamburger = document.getElementById('hamburger-btn');
	const closeBtn = document.getElementById('close-menu-btn');
	const eixosBtn = document.getElementById('eixos-toggle-btn');
	const submenu = document.getElementById('submenu-eixos');
	const eixosArrow = document.getElementById('eixos-arrow');
	const menuBgClose = document.getElementById('menu-bg-close');
		function openMenu() {
			if (menu) menu.style.display = 'flex';
			menuOpen = true;
			document.body.style.overflow = 'hidden';
		}
		function closeMenu() {
			if (menu) menu.style.display = 'none';
			menuOpen = false;
			eixosOpen = false;
			if (submenu) submenu.style.display = 'none';
			if (eixosBtn) eixosBtn.setAttribute('aria-expanded', 'false');
			if (eixosArrow) eixosArrow.style.transform = 'rotate(0deg)';
			document.body.style.overflow = '';
		}
		function toggleEixos() {
			eixosOpen = !eixosOpen;
			if (submenu) submenu.style.display = eixosOpen ? 'flex' : 'none';
			if (eixosBtn) eixosBtn.setAttribute('aria-expanded', eixosOpen ? 'true' : 'false');
			if (eixosArrow) eixosArrow.style.transform = eixosOpen ? 'rotate(90deg)' : 'rotate(0deg)';
		}
	hamburger && hamburger.addEventListener('click', openMenu);
	closeBtn && closeBtn.addEventListener('click', closeMenu);
	menuBgClose && menuBgClose.addEventListener('click', closeMenu);
	eixosBtn && eixosBtn.addEventListener('click', toggleEixos);
	// Close menu on link click
	document.querySelectorAll('.menu-link').forEach(link => {
		link.addEventListener('click', closeMenu);
	});
	document.querySelectorAll('.submenu-link').forEach(link => {
		link.addEventListener('click', closeMenu);
	});
</script>
<style>
	header {
		padding: 0 1em;
		background: white;
		box-shadow: 0 2px 8px rgba(var(--black), 5%);
	}
	h2 {
		margin: 0;
		font-size: 1em;
	}
	h2 a,
	h2 a.active {
		text-decoration: none;
	}
	.social-links,
	.social-links a {
		display: flex;
	}
	@media (max-width: 1024px) {
		.lg\\:flex {
			display: none !important;
		}
	}
	@media (min-width: 1024px) {
		.lg\\:flex {
			display: flex !important;
		}
		.lg\\:hidden {
			display: none !important;
		}
	}
	@media (max-width: 720px) {
		.social-links {
			display: none;
		}
	}
	.animate-slidein {
		animation: slidein 0.2s cubic-bezier(0.4,0,0.2,1);
	}
	@keyframes slidein {
		from { transform: translateX(-100%); opacity: 0; }
		to { transform: translateX(0); opacity: 1; }
	}
</style>
