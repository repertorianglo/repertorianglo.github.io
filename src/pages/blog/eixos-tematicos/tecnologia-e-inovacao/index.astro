---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import FormattedDate from '../../../../components/FormattedDate.astro';
import EixosTematico from '../../../../layouts/EixosTematico.astro';
import { grupos } from '../../../../common/pessoas';

const eixos = (await getCollection('eixosTematicos'));
const eixo = eixos.find(e => e.id === '6-tecnologia-e-inovacao');
const posts = await getCollection('tecnologia-e-inovacao');

// Import hero images for each post
const postsWithHeroImages = await Promise.all(
	posts.map(async (post) => {
		let heroImage;
        console.log(`../../../../assets/eixos-tematicos/tecnologia-e-inovacao/${post.id}/hero.png`)
		try {
			heroImage = await import(`../../../../assets/eixos-tematicos/tecnologia-e-inovacao/${post.id}/hero.png`);
		} catch (error) {
			console.warn(`Hero image not found for post: ${post.id}`);
		}
		return { ...post, heroImage };
	})
);

---
{eixo && (
	<EixosTematico eixo={eixo.data}>
		<div class="posts-grid">
            {postsWithHeroImages.map(item => (
				<a 
					class="post-card"
					href={`/blog/eixos-tematicos/tecnologia-e-inovacao/posts/${item.id}`}
					style="cursor: pointer; text-decoration: none; color: inherit;"
				>
					<div class="post-content">
                        {item.heroImage && (
							<div class="hero-image">
								<Image src={item.heroImage.default} alt={`${item.data.titulo} - Hero Image`} width={400} height={225} />
							</div>
						)}
						<h2 class="post-title">{item.data.titulo}</h2>
						<div class="post-meta">
							<div class="post-date"><FormattedDate date={item.data.dataPublicacao} /></div>
						</div>
						{typeof item.data.grupo === 'number' && (
							<div class="post-students">
								<strong>Criado por: </strong> {grupos[item.data.grupo].alunos.join(', ')}
							</div>
						)}
					</div>
				</a>
            ))}
        </div>
    </EixosTematico>
)}

<style>
.posts-grid {
    display: grid;
    gap: 2rem;
    margin-top: 2rem;
}

.post-card {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: var(--box-shadow);
    border: 1px solid rgba(var(--primary), 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.post-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(var(--gray), 35%), 0 12px 32px rgba(var(--gray), 40%);
}

.post-content {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.hero-image {
    width: 100%;
    margin-bottom: 0.5rem;
}

.hero-image img {
    display: block;
    width: 100%;
    height: auto;
    border-radius: 8px;
    object-fit: cover;
}

.post-title {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: rgb(var(--primary));
    line-height: 1.3;
}

.post-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.9rem;
    color: rgb(var(--gray));
}

.post-date {
    font-weight: 600;
}

.post-author {
    font-style: italic;
}

.post-group {
    background: rgba(var(--blue-anglo), 0.1);
    color: rgb(var(--blue-anglo));
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
    font-weight: 600;
}

.post-students {
    font-size: 0.9rem;
    color: rgb(var(--gray-dark));
    padding: 0.75rem;
    background: rgba(var(--gray-light), 0.5);
    border-radius: 8px;
    border-left: 3px solid rgb(var(--blue-anglo));
}

.post-students strong {
    color: rgb(var(--primary));
}

@media (max-width: 768px) {
    .posts-grid {
        gap: 1.5rem;
    }
    
    .post-card {
        padding: 1rem;
    }
    
    .post-title {
        font-size: 1.25rem;
    }
    
    .post-meta {
        flex-direction: column;
        gap: 0.5rem;
    }
</style>