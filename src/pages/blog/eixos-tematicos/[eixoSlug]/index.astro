---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import PostCard from '../../../../components/PostCard.astro';
import FormattedDate from '../../../../components/FormattedDate.astro';
import EixosTematico from '../../../../layouts/EixosTematico.astro';
import type { EixoTematicoI } from '../../../../common/eixosTematicos';
import type { DataCollectionKey } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import type { DataEntryMap } from 'astro:content';

const { eixoSlug } = Astro.params;
const eixos = await getCollection('eixosTematicos');
const eixo = (eixos.find(e => e.data.slug === eixoSlug as DataCollectionKey) as unknown as CollectionEntry<'eixosTematicos'>);
const posts = await getCollection(eixoSlug as DataCollectionKey);

export async function getStaticPaths() {
	const eixos = await getCollection('eixosTematicos');

	return eixos.map(eixo => ({
		params: { eixoSlug: eixo.data.slug },
	}));
}

// Import hero images for each post
const postsWithHeroImages = await Promise.all(
	posts.map(async (post) => {
		let heroImage;
        // console.log(`../../../../assets/eixos-tematicos/${eixoSlug}/${post.id}/hero.png`)
		try {
			heroImage = await import(`../../../../assets/eixos-tematicos/${eixoSlug}/${post.id}/hero.png`);
		} catch (error) {
			console.warn(`Hero image not found for post: ${post.id}`);
		}
		return { ...post, heroImage };
	})
);

---
{eixo && (
	<EixosTematico eixo={eixo}>
        {postsWithHeroImages.map(item => (
            <PostCard
                href={`/blog/eixos-tematicos/${eixoSlug}/posts/${item.id}`}
                heroImage={item.heroImage}
                data={item.data as any}
            />
        ))}
    </EixosTematico>
)}
